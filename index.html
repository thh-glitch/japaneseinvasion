<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™‚å…‰æª”æ¡ˆé¤¨ï¼šæŠ—æˆ°é¢¨é›² (ä¿®å¾©ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap');

/* --- å…¨å±€è¨­å®š --- */
	        body {
	            margin: 0; padding: 0;
	            overflow: hidden;
	            background-color: #0c0a09;
	            font-family: 'Noto Serif TC', 'Noto Color Emoji', sans-serif;
	            touch-action: none; user-select: none;
	        }
	        /* ä¿®æ­£ iOS å…¼å®¹æ€§ï¼šç¢ºä¿è¦–å£é«˜åº¦æ­£ç¢º */
	        @supports (-webkit-touch-callout: none) {
	            #viewport {
	                height: -webkit-fill-available;
	            }
	        }

        #viewport {
            position: relative; width: 100vw; height: 100vh;
            background: #111; overflow: hidden;
        }

        /* --- éŠæˆ²ä¸–ç•Œ --- */
        #world {
            position: absolute; top: 0; left: 0;
            height: 100%;
            transition: transform 0.1s linear;
        }

        .layer-wall {
            position: absolute; top: 0; left: 0; right: 0; bottom: 30%;
            z-index: 0; background-size: 80px 80px;
        }
        .layer-floor {
            position: absolute; bottom: 0; left: 0; right: 0; height: 30%;
            z-index: 1; transform-origin: bottom;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.8);
        }

        /* æè³ª */
        .floor-wood { background: repeating-linear-gradient(90deg, #2d1b15 0, #2d1b15 20px, #3e2723 20px, #3e2723 40px); border-top: 4px solid #1a100c; }
        .floor-ruin { background-color: #1c1917; background-image: radial-gradient(#292524 20%, transparent 20%); background-size: 30px 30px; border-top: 4px solid #000; }
        .floor-cave { background-color: #262626; border-top: 4px solid #171717; }
        .floor-red { background-color: #450a0a; background-image: repeating-linear-gradient(45deg, #7f1d1d 0, #7f1d1d 10px, #450a0a 10px, #450a0a 20px); border-top: 4px solid #280505; }
        
        .wall-office { background-color: #292524; background-image: linear-gradient(#333 1px, transparent 1px); background-size: 100% 40px; }
        .wall-ruin { background-color: #2a0a0a; }
        .wall-cave { background-color: #1f1f22; }

        /* --- è§’è‰²èˆ‡ç‰©å“ (é—œéµä¿®å¾©éƒ¨åˆ†) --- */
        .sprite {
            position: absolute;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            transform: translate(-50%, -100%);
            z-index: 10;
            width: 100px; height: 120px; /* çµ±ä¸€å®¹å™¨å¤§å° */
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ°å­å…ƒç´ æˆ–ç”± JS åˆ¤æ–·è·é›¢ */
        }

        /* ç‰©å“æ¨¡å‹ï¼šåœ–ç‰‡èˆ‡ Emoji å…±ç”¨çš„åŸºç¤æ¨£å¼ */
        .item-model {
            width: 90px; height: 90px;
            display: flex; align-items: center; justify-content: center;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.6));
            transition: all 0.3s;
            cursor: pointer;
            pointer-events: auto; /* æ¢å¾©äº’å‹•é»æ“Š */
            z-index: 15;
        }

        /* åœ–ç‰‡å°ˆç”¨æ¨£å¼ */
        img.item-model {
            object-fit: contain;
            /* ç§»é™¤ font-sizeï¼Œé¿å…å½±éŸ¿åœ–ç‰‡ */
        }

        /* Emoji å°ˆç”¨æ¨£å¼ (å›é€€ç”¨) */
        div.item-model.emoji-mode {
            font-size: 75px;
            line-height: 1;
        }

        .player-model {
            font-size: 90px;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.8));
            z-index: 20;
            line-height: 90px;
        }
        
        .decor-model {
            font-size: 75px; filter: brightness(0.5) blur(0.5px); opacity: 0.8; pointer-events: none; z-index: 5;
            line-height: 90px;
        }

        /* äº’å‹•æç¤ºæ°£æ³¡ (å…‰åœˆ) - ä¿®å¾©é¸æ“‡å™¨ */
        .sprite.active .item-model {
            filter: drop-shadow(0 0 20px #fbbf24) brightness(1.3);
            transform: scale(1.15) translateY(-10px);
        }

        /* æ‰è½å‹•ç•« */
        .drop-anim .item-model { animation: dropBounce 0.6s ease-out; }
        @keyframes dropBounce {
            0% { transform: translateY(-100px) scale(0.5); opacity: 0; }
            60% { transform: translateY(0) scale(1.2); opacity: 1; }
            100% { transform: translateY(0) scale(1); }
        }

        /* å‡ºå£ç™¼å…‰ */
        .exit-glow .item-model { animation: pulse-green 1.5s infinite; filter: drop-shadow(0 0 30px #22c55e); }
        @keyframes pulse-green { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* --- UI ä»‹é¢ --- */
        .ui-layer { position: fixed; inset: 0; pointer-events: none; z-index: 50; display: none; }
        .pointer-auto { pointer-events: auto; }

        /* ä¿®æ­£åå­—éµä½ˆå±€ */
        .dpad-area { 
            position: absolute; bottom: 20px; left: 20px; 
            width: 180px; height: 180px; /* å¢åŠ å€åŸŸå¤§å° */
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 5px; /* æŒ‰éˆ•é–“è· */
        }
        .dpad-btn {
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.15); border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            color: white; touch-action: manipulation;
            position: relative; /* ç¢ºä¿åœ¨ grid ä½ˆå±€ä¸­èƒ½æ­£å¸¸é¡¯ç¤º */
        }
        .dpad-btn:active { background: rgba(251, 191, 36, 0.6); border-color: #fbbf24; }
        /* ä½¿ç”¨ grid-area é‡æ–°å®šä½æŒ‰éˆ• */
        .btn-u { grid-area: 1 / 2 / 2 / 3; } /* ä¸Šï¼šç¬¬1è¡Œï¼Œç¬¬2åˆ— */
        .btn-d { grid-area: 3 / 2 / 4 / 3; } /* ä¸‹ï¼šç¬¬3è¡Œï¼Œç¬¬2åˆ— */
        .btn-l { grid-area: 2 / 1 / 3 / 2; } /* å·¦ï¼šç¬¬2è¡Œï¼Œç¬¬1åˆ— */
        .btn-r { grid-area: 2 / 3 / 3 / 4; } /* å³ï¼šç¬¬2è¡Œï¼Œç¬¬3åˆ— */
        /* éš±è—ä¸­é–“çš„æŒ‰éˆ•å€åŸŸï¼Œé¿å…èª¤è§¸ */
        .btn-center { display: none; }

        #action-btn {
            position: absolute; bottom: 40px; right: 40px;
            width: 100px; height: 100px;
            background: rgba(0,0,0,0.5); border: 4px solid #57534e;
            border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #a8a29e; font-weight: bold; transition: all 0.2s; backdrop-filter: blur(4px);
        }
        #action-btn.active { 
            background: rgba(251, 191, 36, 0.9); border-color: #fff;
            color: black; transform: scale(1.1); box-shadow: 0 0 30px #fbbf24; 
        }

        .top-hud {
            position: absolute; top: 0; left: 0; width: 100%; padding: 15px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            display: flex; justify-content: space-between; color: white;
        }

        /* æ¨¡æ…‹æ¡† */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; align-items: center; justify-content: center;
            z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        
        .modal-box {
            background: #f5f5f4; width: 90%; max-width: 500px;
            border-radius: 12px; overflow: hidden; border: 4px solid #444; color: #222;
            box-shadow: 0 10px 50px rgba(0,0,0,1);
        }

        /* ç­†è¨˜æœ¬ */
        #notebook {
            position: fixed; top: 0; right: 0; bottom: 0; width: 350px;
            background: #fefce8; transform: translateX(100%);
            transition: transform 0.3s; z-index: 150; border-left: 5px solid #333;
            display: flex; flex-direction: column;
        }
        #notebook.open { transform: translateX(0); }

        #toast {
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9); color: #fbbf24;
            padding: 10px 20px; border-radius: 30px; border: 2px solid #fbbf24;
            font-weight: bold; z-index: 200; opacity: 0; transition: opacity 0.3s;
            pointer-events: none; font-size: 18px;
        }

        .name-tag {
            background: rgba(0,0,0,0.7); color: white; padding: 2px 6px;
            border-radius: 4px; font-size: 12px; margin-top: 5px; font-weight: bold; white-space: nowrap;
        }

        #ending-screen {
            position: fixed; inset: 0; background: #1c1917; z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            color: #d6d3d1; text-align: center; padding: 2rem; overflow-y: auto;
        }
        
    </style>
</head>
<body>

    <div id="viewport">
        <div id="world">
            <div id="layer-wall" class="layer-wall bg-stone-800"></div>
            <div id="layer-floor" class="layer-floor floor-wood"></div>
            <div id="layer-decor"></div>
            <div id="layer-main">
                <div id="player" class="sprite" style="left: 100px; top: 85%;">
                    <img src="player.webp" class="player-model" alt="Player" onload="this.style.display='block'; this.nextElementSibling.style.display='none';" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" style="display:none; width:90px; height:90px; object-fit:contain;">
                    <div class="player-model emoji-fallback">ğŸ•µï¸â€â™‚ï¸</div>
                    <div class="name-tag bg-blue-600">ä½ </div>
                </div>
            </div>
        </div>
    </div>

    <div class="ui-layer" id="ui-layer">
        <div class="top-hud">
            <div>
                <div class="text-[10px] text-stone-400 uppercase tracking-widest">Year</div>
                <div id="hud-year" class="text-3xl font-bold text-amber-500 font-mono drop-shadow-md">1931</div>
                <div id="hud-title" class="text-sm text-stone-300">ç€‹é™½äº‹è®Š</div>
            </div>
            
            <div class="flex flex-col items-end">
                <div class="text-[10px] text-stone-400 uppercase tracking-widest">Inventory</div>
                <div id="hud-inventory" class="flex gap-2 mt-1 min-h-[30px]">
                    <span class="text-xs text-stone-600 italic mt-1">èƒŒåŒ…æ˜¯ç©ºçš„</span>
                </div>
            </div>
        </div>

        <button onclick="toggleNotebook()" class="pointer-auto absolute top-20 right-6 bg-stone-800 p-3 rounded-full border-2 border-stone-600 shadow-xl hover:scale-110 transition">
            <i data-lucide="book-open" class="text-amber-500 w-6 h-6"></i>
            <span id="note-dot" class="absolute top-0 right-0 w-3 h-3 bg-red-600 rounded-full hidden"></span>
        </button>

<div class="dpad-area pointer-auto">
	            <div class="dpad-btn btn-u"><i data-lucide="chevron-up" class="w-8 h-8"></i></div>
	            <div class="dpad-btn btn-l"><i data-lucide="chevron-left" class="w-8 h-8"></i></div>
	            <div class="dpad-btn btn-center"></div> <!-- ä½”ä½ç¬¦ï¼Œç¢ºä¿åå­—éµä½ˆå±€æ­£ç¢º -->
	            <div class="dpad-btn btn-r"><i data-lucide="chevron-right" class="w-8 h-8"></i></div>
	            <div class="dpad-btn btn-d"><i data-lucide="chevron-down" class="w-8 h-8"></i></div>
	        </div>

        <div id="action-btn" class="pointer-auto" onclick="triggerInteract()">
            <i data-lucide="hand" class="w-10 h-10 mb-1"></i>
            <span class="text-sm">èª¿æŸ¥</span>
        </div>

        <div class="absolute bottom-4 w-full text-center text-white/30 text-xs hidden md:block">
            WASD ç§»å‹• | ç©ºç™½éµ / Enter äº’å‹•
        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <div class="bg-stone-800 p-5 text-white flex items-center gap-4 border-b-4 border-amber-600">
                <div id="m-icon-box" class="w-20 h-20 bg-stone-700 rounded flex items-center justify-center overflow-hidden text-6xl">
                    </div>
                <h2 id="m-title" class="text-2xl font-bold">æ¨™é¡Œ</h2>
            </div>
            <div class="p-6 overflow-y-auto max-h-[60vh]">
                <p id="m-desc" class="text-xl text-stone-800 leading-relaxed font-medium mb-4">...</p>
                <div id="m-dse" class="bg-amber-100 border-l-4 border-amber-600 p-3 mb-4 rounded text-sm text-amber-900 hidden">
                    <strong>ğŸ“ æ­·å²é‡é»ï¼š</strong><span id="m-dse-text"></span>
                </div>
                <div id="m-opts" class="flex flex-col gap-2"></div>
            </div>
            <div class="bg-stone-200 p-3 text-right">
                <button onclick="closeModal()" class="px-6 py-3 bg-stone-700 text-white rounded font-bold hover:bg-stone-600 text-lg">é—œé–‰</button>
            </div>
        </div>
    </div>

    <div id="notebook" class="pointer-auto shadow-2xl">
        <div class="bg-stone-800 p-4 text-white flex justify-between items-center">
            <span class="font-bold flex gap-2 items-center text-lg"><i data-lucide="book"></i> èª¿æŸ¥ç­†è¨˜</span>
            <button onclick="toggleNotebook()"><i data-lucide="x"></i></button>
        </div>
        <div id="nb-content" class="flex-1 overflow-y-auto p-4 space-y-4 bg-[#fefce8]">
            <div class="text-center text-gray-400 mt-10">æš«ç„¡è¨˜éŒ„</div>
        </div>
    </div>

    <div id="toast">ç²å¾—ç‰©å“ï¼</div>

    <div id="intro-screen" class="modal-overlay show" style="background: #000; z-index: 200;">
        <div class="max-w-2xl w-full bg-stone-900 border-2 border-stone-700 rounded-lg shadow-2xl m-4 p-8 overflow-y-auto max-h-screen">
            <div class="bg-amber-900 p-6 border-b-4 border-amber-700 -mx-8 -mt-8 mb-6">
                <h1 class="text-3xl font-bold text-white flex items-center gap-3">
                    <i data-lucide="file-text"></i> æ©Ÿå¯†æª”æ¡ˆï¼š<span id="intro-year" class="font-mono">1931</span>
                </h1>
                <p id="intro-title" class="text-amber-200 text-lg mt-1">...</p>
            </div>
            <div class="space-y-6">
                <div>
                    <h3 class="text-amber-500 font-bold text-sm uppercase tracking-widest mb-2">æ­·å²èƒŒæ™¯ BACKGROUND</h3>
                    <p id="intro-hist" class="text-stone-300 leading-relaxed text-lg">...</p>
                </div>
                <div class="bg-black/40 p-4 rounded border-l-4 border-green-500 mb-8">
                    <h3 class="text-green-400 text-xs font-bold uppercase mb-1">ç•¶å‰ä»»å‹™ MISSION</h3>
                    <p id="intro-obj" class="text-white font-bold text-lg">...</p>
                </div>
                <div class="flex justify-center">
                     <button onclick="startGame()" class="px-12 py-4 bg-amber-700 hover:bg-amber-600 text-white font-bold rounded text-xl shadow-lg transform transition hover:scale-105 active:scale-95">
                        æ¥å—ä»»å‹™
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="ending-screen">
        <div class="max-w-3xl w-full p-8 bg-stone-900 rounded-lg border-2 border-amber-600 shadow-2xl">
            <h1 class="text-5xl text-amber-500 font-bold mb-8 font-serif border-b border-amber-800 pb-4">æŠ—æˆ°å‹åˆ©èˆ‡å½±éŸ¿</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                <div class="bg-stone-800 p-6 rounded border-t-4 border-blue-500">
                    <h2 class="text-xl text-white font-bold mb-2">ğŸŒ åœ‹éš›åœ°ä½</h2>
                    <p class="text-stone-400 text-sm leading-relaxed">æˆ°å¾Œï¼Œä¸­åœ‹åœ‹éš›åœ°ä½æå‡ï¼Œæˆç‚º<strong>è¯åˆåœ‹å‰µå§‹æœƒå“¡åœ‹</strong>ï¼Œä¸¦æ“”ä»»å®‰ç†æœƒäº”å¤§å¸¸ä»»ç†äº‹åœ‹ä¹‹ä¸€ã€‚</p>
                </div>
                <div class="bg-stone-800 p-6 rounded border-t-4 border-red-500">
                    <h2 class="text-xl text-white font-bold mb-2">ğŸ“œ å»¢é™¤æ¢ç´„</h2>
                    <p class="text-stone-400 text-sm leading-relaxed">å„åœ‹å»¢é™¤ä»¥å¾€ç°½è¨‚ä¹‹ä¸å¹³ç­‰æ¢ç´„ï¼Œæ”¶å›ç§Ÿç•Œèˆ‡æ²»å¤–æ³•æ¬Šã€‚</p>
                </div>
                <div class="bg-stone-800 p-6 rounded border-t-4 border-green-500">
                    <h2 class="text-xl text-white font-bold mb-2">ğŸ—ºï¸ æ”¶å¾©å¤±åœ°</h2>
                    <p class="text-stone-400 text-sm leading-relaxed">æ—¥æœ¬æ­¸é‚„æ±åŒ—ä¸‰çœï¼Œ<strong>å°ç£åŠæ¾æ¹–åˆ—å³¶</strong>é‡å›ä¸­åœ‹ç‰ˆåœ–ã€‚</p>
                </div>
            </div>
            <div class="mt-12 text-center">
                <button onclick="location.reload()" class="px-10 py-4 bg-amber-700 hover:bg-amber-600 text-white font-bold rounded-full">é‡æ–°é–‹å§‹æ­·å²æ—…ç¨‹</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. åƒæ•¸ ---
        const WORLD_WIDTH = 2800; 
        const SPEED = 4;
        const INTERACT_DIST_X = 350; // å¾®èª¿è·é›¢
        const INTERACT_DIST_Y = 250;
        const FLOOR_Y_MIN = 60;
        const FLOOR_Y_MAX = 95;

        let player = { x: 100, y: 80, el: null };
        let keys = { u:false, d:false, l:false, r:false };
        let gameState = { level: 0, inventory: [], unlocked: [], notes: [], interactions: {} };
        let isPaused = true;
        let activeItem = null;

        // --- 2. é—œå¡æ•¸æ“š (å·²ç¢ºèªæ‰€æœ‰ ID èˆ‡é—œä¿‚éˆæ¥ç„¡èª¤) ---
        const LEVELS = [
            {
                id: 0, year: "1931", title: "ç€‹é™½äº‹è®Š",
                history: "1931å¹´9æœˆ18æ—¥ï¼Œæ—¥è»è‡ªè¡Œç‚¸æ¯€å—æ»¿éµè·¯æŸ³æ¢æ¹–æ®µï¼Œåèª£ä¸­åœ‹è»éšŠæ‰€ç‚ºï¼Œç‚®è½ŸåŒ—å¤§ç‡Ÿã€‚é€™ä¾¿æ˜¯éœ‡é©šä¸­å¤–çš„ã€Œä¹ä¸€å…«äº‹è®Šã€ã€‚",
                objective: "å°‹æ‰¾ä¸Šç´šæŒ‡ç¤ºï¼Œä¸¦å®‰å…¨æ’¤é›¢è¾¦å…¬å®¤ã€‚",
                floor: "floor-wood", wall: "wall-office",
                decor: [
                    {x: 200, y: 40, e:"ğŸªŸ"}, {x: 600, y: 45, e:"ğŸ•°ï¸"}, {x: 1000, y: 50, e:"ğŸª´"}, 
                    {x: 1400, y: 40, e:"ğŸ–¼ï¸"}, {x: 1800, y: 55, e:"ğŸª‘"}, {x: 50, y: 60, e:"ğŸ—„ï¸"}
                ],
                items: [
                    { id: "rifle", x: 250, y: 70, img: "rifle.webp", emoji: "ğŸ”«", name: "æ­¥æ§", type: "read", desc: "ä¸€æŠŠè¢«ä¸Ÿæ£„çš„æ­¥æ§ã€‚æ—¥è»ç‚¸æ¯€éµè·¯ä¸¦è²ç¨±æ‰¾åˆ°ä¸­åœ‹è»å‚™çš„æ§æï¼Œä»¥æ­¤ç‚ºè—‰å£ç™¼å‹•æ”»æ“Šã€‚", dse: "æ—¥è»è£½é€ æŸ³æ¢æ¹–äº‹ä»¶ï¼Œæ ½è´“å«ç¦ã€‚" },
                    { id: "book", x: 300, y: 50, img: "bookshelf.webp", emoji: "ğŸ“š", name: "æ›¸æ¶", type: "read", desc: "æ›¸æ¶ä¸Šæœ‰ä¸€æœ¬ã€Šç”°ä¸­å¥æ‘ºã€‹ã€‚ä¸Šé¢å¯«è‘—ï¼šã€æ¬²å¾æœä¸­åœ‹ï¼Œå¿…å…ˆå¾æœæ»¿è’™ã€ã€‚", dse: "æ—¥æœ¬å¤§é™¸æ”¿ç­–çš„æ“´å¼µè—åœ–ã€‚" },
                    { id: "news", x: 500, y: 75, img: "newspaper_1931.webp", emoji: "ğŸ“°", name: "å ±ç´™", type: "read", desc: "ã€Šç››äº¬æ™‚å ±ã€‹é ­æ¢ï¼šã€æ—¥è»èª£æŒ‡ä¸­åœ‹è»éšŠç‚¸æ¯€æŸ³æ¢æ¹–éµè·¯ã€ã€‚é€™æ˜¯æ—¥è»ä¾µç•¥çš„è—‰å£ã€‚", dse: "ä¹ä¸€å…«äº‹è®Šå°ç«ç·šï¼šæŸ³æ¢æ¹–äº‹ä»¶ã€‚" },
                    { id: "phone", x: 700, y: 72, img: "phone.webp", emoji: "â˜ï¸", name: "é›»è©±", type: "read", desc: "æ—¥è»æ­£æ”»æ‰“ç€‹é™½ï¼Œé›»è©±ç·šæ–·äº†ï¼Œé€šè¨Šä¸­æ–·ã€‚", dse: null },
                    { id: "tea", x: 900, y: 60, img: "teapot.webp", emoji: "ğŸ«–", name: "èŒ¶å£º", type: "read", desc: "èŒ¶é‚„æ˜¯ç†±çš„ã€‚éƒ¨éšŠæ­£åœ¨åœæ”»å…±ç”¢é»¨ï¼Œé›¢é–‹å¾—éå¸¸å€‰ä¿ƒã€‚", dse: null },
                    { id: "map", x: 1100, y: 50, img: "map_northeast.webp", emoji: "ğŸ—ºï¸", name: "åœ°åœ–", type: "read", desc: "åœ°åœ–ä¸Šæ¨™ç¤ºè‘—å—æ»¿éµè·¯ã€‚æ—¥è»æ—©å·²åœ¨æ­¤é§ç´®å¤§é‡å…µåŠ›ã€‚", dse: "æ—¥æœ¬å¤§é™¸æ”¿ç­–ï¼šæ¬²å¾æœä¸­åœ‹ï¼Œå¿…å…ˆå¾æœæ»¿è’™ã€‚" },
                    
                    { id: "calendar", x: 2000, y: 45, img: "calendar_918.webp", emoji: "ğŸ“…", name: "æ—¥æ›†", type: "read", desc: "æ—¥æ›†åœç•™åœ¨ï¼š9æœˆ18æ—¥ã€‚é€™ä¸€å¤©å°‡è¢«æ­·å²éŠ˜è¨˜ã€‚", isKey: true }, 
                    { id: "safe", x: 1600, y: 70, img: "safe.webp", emoji: "ğŸ”", name: "ä¿éšªç®±", type: "lock", code: "0918", hint: "æˆ‘ä¸çŸ¥é“å¯†ç¢¼... (è«‹å°‹æ‰¾ç·šç´¢)", unlock: "telegram", desc: "ä¿éšªç®±å·²é–‹å•Ÿã€‚" },
                    { id: "telegram", x: 1750, y: 80, img: "telegram.webp", emoji: "ğŸ“œ", name: "å¯†é›»", hidden: true, type: "take", desc: "å¯†é›»å…§å®¹ï¼šã€ç‚ºå…äº‹æ…‹æ“´å¤§ï¼Œçµ•å°ä¸è¨±æŠµæŠ—ï¼Œè½å€™åœ‹è¯èª¿åœã€‚ã€", dse: "åœ‹æ°‘æ”¿åºœæ¡ã€Œä¸æŠµæŠ—æ”¿ç­–ã€ï¼Œå¯„æœ›åœ‹è¯èª¿åœã€‚", isKey: true },
                    
                    { id: "door", x: 2400, y: 65, img: "door_office.webp", emoji: "ğŸšª", name: "å¤§é–€", type: "exit", req: "telegram", msg: "æœªæ‹¿åˆ°æŒ‡ä»¤ï¼(è«‹æª¢æŸ¥ä¿éšªç®±)", quiz:{q:"é¢å°æ—¥è»é€²æ”»ï¼Œä¸Šç´šçš„å‘½ä»¤æ˜¯ï¼Ÿ", opts:["æŠµæŠ—", "ä¸æŠµæŠ—", "è«‡åˆ¤"], ans:1}, success: "ä½ å’¬è‘—ç‰™åŸ·è¡Œäº†å‘½ä»¤ï¼Œå¸¶è‘—éºæ†¾æ’¤é›¢äº†ç€‹é™½ã€‚" }
                ]
            },
            {
                id: 1, year: "1936", title: "è¥¿å®‰äº‹è®Š",
                history: "1936å¹´ï¼Œé¢å°æ—¥è»æ­¥æ­¥é€²é€¼ï¼Œè”£ä»‹çŸ³ä»å …æŒã€Œæ”˜å¤–å¿…å…ˆå®‰å…§ã€çš„æ”¿ç­–ã€‚å¼µå­¸è‰¯å’Œæ¥Šè™åŸåœ¨è¥¿å®‰ç™¼å‹•ã€Œå…µè««ã€ï¼Œæ‰£æŠ¼è”£ä»‹çŸ³ï¼Œè¦æ±‚åœæ­¢å…§æˆ°ï¼Œä¸€è‡´æŠ—æ—¥ã€‚",
                objective: "å°‹æ‰¾é—œéµæ–‡ä»¶ï¼Œèªªæœè¡›å…µæ”¾è¡Œã€‚",
                floor: "floor-wood", wall: "wall-office",
                decor: [{x: 300, y: 40, e:"ğŸº"}, {x: 700, y: 40, e:"ğŸ®"}, {x: 1200, y: 50, e:"ğŸ›‹ï¸"}, {x: 1600, y: 40, e:"ğŸ–¼ï¸"}],
                items: [
                    { id: "shoes", x: 400, y: 80, img: "slippers.webp", emoji: "ğŸ‘", name: "æ‹–é‹", type: "read", desc: "åœ°ä¸Šæœ‰ä¸€éš»æ‹–é‹ã€‚å§”å“¡é•·é€ƒè·‘æ™‚é€£é‹éƒ½æ²’ç©¿å¥½ã€‚", dse: "è”£ä»‹çŸ³å€‰çš‡å‡ºé€ƒã€‚" },
                    { id: "bed", x: 500, y: 70, img: "bed_messy.webp", emoji: "ğŸ›ï¸", name: "åºŠé‹ª", type: "read", desc: "åºŠé‹ªå‡Œäº‚ï¼Œè”£å§”å“¡æ›¾è¢«å›šç¦æ–¼æ­¤è™•â€”è¥¿å®‰å¸‚çš„å¼µå­¸è‰¯å…¬é¤¨ã€‚", dse: null },
                    { id: "teeth", x: 600, y: 65, img: "glass_teeth.webp", emoji: "ğŸ¥›", name: "ç»ç’ƒæ¯", type: "read", desc: "æ¯å­è£¡æ³¡è‘—å‡ç‰™ã€‚é€™æ˜¯è”£ä»‹çŸ³çš„è²¼èº«ç‰©å“ã€‚", dse: null },
                    
                    { id: "poster", x: 1800, y: 50, img: "poster_songhua.webp", emoji: "ğŸ“œ", name: "æ¨‚è­œ", type: "read", desc: "ã€Œæˆ‘çš„å®¶åœ¨æ±åŒ—æ¾èŠ±æ±Ÿä¸Š...ä¹ä¸€å…«ã€ä¹ä¸€å…«ï¼Œåœ¨é‚£å€‹æ‚²æ…˜çš„æ™‚å€™...ã€æ—¥è»ä¾µæ“¾ä¸æ–·ã€‚", dse: "å…µè««è¨´æ±‚ã€‚" },
                    { id: "radio_xian", x: 1100, y: 60, img: "radio_old.webp", emoji: "ğŸ“»", name: "æ”¶éŸ³æ©Ÿ", type: "read", desc: "æ’­æ”¾è‘—å…¨åœ‹å„ç•Œå‘¼ç±²å’Œå¹³è§£æ±ºå…©é»¨è¡çªã€åœ˜çµæŠ—æ—¥çš„å‘¼è²ã€‚", dse: "è¼¿è«–å‘¼ç±²ã€‚" },
                    { id: "news_extra", x: 1300, y: 50, img: "newspaper_xian.webp", emoji: "ğŸ“°", name: "è™Ÿå¤–", type: "read", desc: "è™Ÿå¤–ï¼šå¼µå­¸è‰¯ã€æ¥Šè™åŸç™¼å‹•å…µè««ï¼Œæ‰£æŠ¼è”£ä»‹çŸ³ï¼", dse: "è¥¿å®‰äº‹è®Šçˆ†ç™¼ã€‚" },

                    { id: "window", x: 900, y: 50, img: "window_snow.webp", emoji: "ğŸªŸ", name: "çª—æˆ¶", type: "multi_search", steps: ["çª—æˆ¶å¤§é–‹ã€‚", "çª—å°ç¸«éš™æœ‰æ±è¥¿...", "æ‰¾åˆ°ä¸€æŠŠé‘°åŒ™ï¼"], unlock: "key", desc: "çª—å°ç©ºäº†ã€‚" },
                    { id: "key", x: 950, y: 80, img: "key.webp", emoji: "ğŸ”‘", name: "é‘°åŒ™", hidden: true, type: "take", desc: "ä¸€æŠŠé»ƒéŠ…é‘°åŒ™ã€‚", isTool: true },
                    { id: "drawer", x: 1400, y: 75, img: "drawer.webp", emoji: "ğŸ—„ï¸", name: "æŠ½å±œ", type: "key_lock", req: "key", msg: "é–ä½äº†ã€‚(é‘°åŒ™æœƒåœ¨å“ªè£¡ï¼Ÿ)", unlock: "doc", desc: "æŠ½å±œæ‰“é–‹äº†ã€‚" },
                    
                    { id: "doc", x: 1550, y: 80, img: "doc_ccp.webp", emoji: "ğŸ“„", name: "æ–‡ä»¶", hidden: true, type: "take", desc: "ä¸­å…±å°‹æ±‚åˆä½œï¼Œæå‡ºã€åœæ­¢å…§æˆ°ï¼Œä¸€è‡´æŠ—æ—¥ã€ã€‚", dse: "è¥¿å®‰äº‹è®Šä¿ƒæˆç¬¬äºŒæ¬¡åœ‹å…±åˆä½œã€‚", isKey: true },
                    
                    { id: "guard", x: 2200, y: 75, img: "guard.webp", emoji: "ğŸ‘®", name: "è¡›å…µ", type: "exit", req: "doc", msg: "è¡›å…µï¼šã€å£ä»¤ï¼ã€(å»æ‰¾æ–‡ä»¶)", quiz:{q:"å…µè««ç›®çš„æ˜¯ï¼Ÿ", opts:["æ®ºè”£", "åœæ­¢å…§æˆ°ï¼Œä¸€è‡´æŠ—æ—¥"], ans:1}, success: "è¡›å…µæ•¬ç¦®æ”¾è¡Œã€‚" }
                ]
            },
            {
                id: 2, year: "1937", title: "å…¨é¢æŠ—æˆ°",
                history: "1937å¹´7æœˆ7æ—¥ï¼Œç›§æºæ©‹äº‹è®Šçˆ†ç™¼ï¼Œæ¨™èªŒè‘—å…¨é¢æŠ—æˆ°çš„é–‹å§‹ã€‚éš¨å¾Œæ·æ»¬æœƒæˆ°çˆ†ç™¼ï¼Œé›–ç„¶æ‰“ç ´äº†æ—¥è»ã€Œä¸‰å€‹æœˆäº¡è¯ã€çš„è¿·å¤¢ï¼Œä½†ä¸Šæµ·ã€å—äº¬ç›¸ç¹¼æ·ªé™·ã€‚åœ‹æ°‘æ”¿åºœæ±ºå®šé·éƒ½ã€‚",
                objective: "æœé›†ç‰©è³‡ä¿®å¥½å¡è»Šï¼Œæ’¤å¾€å¤§å¾Œæ–¹ã€‚",
                floor: "floor-ruin", wall: "wall-ruin",
                decor: [{x: 200, y: 60, e:"ğŸ”¥"}, {x: 600, y: 70, e:"ğŸ§±"}, {x: 1500, y: 60, e:"ğŸ”¥"}, {x: 1000, y: 50, e:"ğŸšï¸"}],
                items: [
                    { id: "bridge", x: 200, y: 50, img: "lion.webp", emoji: "ğŸ¦", name: "çŸ³ç…å­", type: "read", desc: "ç›§æºæ©‹çŸ³ç…ã€‚1937å¹´7æœˆ7æ—¥ï¼Œæ—¥è»è—‰å£å£«å…µå¤±è¹¤ç™¼å‹•é€²æ”»ã€‚", dse: "ä¸ƒä¸ƒäº‹è®Šï¼šå…¨é¢æŠ—æˆ°èµ·é»ã€‚" },
                    { id: "rubble", x: 400, y: 80, img: "rubble.webp", emoji: "ğŸ§±", name: "å»¢å¢Ÿ", type: "multi_search", steps: ["æ—¥è»å…¥ä¾µï¼Œå¯¦è¡Œä¸‰å…‰æ”¿ç­–ï¼Œå››è™•æˆäº†å»¢å¢Ÿã€‚", "æ®ºå…‰ã€ç‡’å…‰ã€æ¶å…‰...", "ç“¦ç¤«ä¸‹ç™¼ç¾ä¸€å€‹è¼ªèƒï¼"], unlock: "tire", desc: "ç“¦ç¤«å †ã€‚" },
                    { id: "tire", x: 450, y: 85, img: "tire.webp", emoji: "ğŸ›", name: "è¼ªèƒ", hidden: true, type: "take", desc: "å¡è»Šå‚™ç”¨è¼ªèƒã€‚", isKey: true },
                    { id: "motorcycle", x: 900, y: 70, img: "bicycle.webp", emoji: "ğŸï¸", name: "é›»å–®è»Š", type: "multi_search", steps: ["ä¸€è¼›æ—¥è»é›»å–®è»Šã€‚", "æª¢æŸ¥æ²¹ç®±...", "æŠ½åˆ°äº†ä¸€ç½æ±½æ²¹ï¼"], unlock: "gas", desc: "æ²¹ç®±ç©ºäº†ã€‚" },
                    { id: "gas", x: 950, y: 75, img: "gasoline.webp", emoji: "â›½", name: "æ±½æ²¹", hidden: true, type: "take", desc: "ä¸€ç½çè²´çš„æ±½æ²¹ã€‚", isKey: true },
                    { id: "paper", x: 1200, y: 80, img: "newspaper_1937.webp", emoji: "ğŸ“°", name: "æ’’é€€æ‰‹ä»¤", type: "take", desc: "æ‰‹ä»¤ï¼šç‚ºä½¿æ•µäººé‡å‹æ­¦å™¨å¤±æ•ˆï¼Œè¦å¾€é‡æ…¶å¤§å¾Œæ–¹æ’¤é€€ï¼Œå¾Œæ–¹é€Ÿé€Ÿè·Ÿä¸Šã€‚", dse: "é€€å®ˆå¾Œæ–¹ï¼Œä½œæŒä¹…æˆ°ã€‚", isKey: true },
                    { id: "bag", x: 1400, y: 80, img: "bag.webp", emoji: "ğŸ’", name: "åŒ…è¢±", type: "read", desc: "é›£æ°‘éºè½çš„åŒ…è¢±ã€‚", dse: null },
                    { id: "radio", x: 1600, y: 70, img: "radio.webp", emoji: "ğŸ“»", name: "å»£æ’­", type: "read", desc: "å»£æ’­ï¼šã€åœ°ç„¡åˆ†å—åŒ—ï¼Œå¹´ç„¡åˆ†è€å¹¼...ã€", dse: "è”£ä»‹çŸ³å»¬å±±è²æ˜ã€‚" },
                    { id: "poster", x: 1800, y: 50, img: "slogan.webp", emoji: "ğŸ“œ", name: "æ¨™èª", type: "read", desc: "ç‰†ä¸Šåˆ·è‘—æ¨™èªï¼šã€ä¸€å¯¸å±±æ²³ä¸€å¯¸è¡€ã€ã€‚", dse: "å…¨æ°‘æŠ—æˆ°çš„æ±ºå¿ƒã€‚" },
                    
                    { id: "money_mil", x: 1900, y: 75, img: "money_military.webp", emoji: "ğŸ’´", name: "è»ç¥¨", type: "read", desc: "æ—¥è»ç™¼è¡Œçš„è»ç¥¨ã€‚å¼·åˆ¶ä¸­åœ‹ç™¾å§“ä½¿ç”¨ï¼Œæ å¥ªè²¡å¯Œã€‚", dse: "æ—¥æœ¬åœ¨æ·ªé™·å€çš„ç¶“æ¿Ÿæ å¥ªã€‚" },
                    { id: "safe_zone", x: 1700, y: 40, img: "sign_safezone.webp", emoji: "â­•", name: "æ¨™èªŒ", type: "read", desc: "åœ‹éš›å®‰å…¨å€æ¨™èªŒã€‚", dse: "å—äº¬å¤§å± æ®ºæœŸé–“çš„åœ‹éš›æ´åŠ©ï¼Œæˆç«‹å®‰å…¨å€ä¿è­·ä¸­åœ‹äººã€‚" },
                    { id: "flag_puppet", x: 2100, y: 50, img: "flag_wang.webp", emoji: "ğŸ³ï¸", name: "æ——å¹Ÿ", type: "read", desc: "å½åœ‹æ°‘æ”¿åºœçš„æ——å¹Ÿã€‚", dse: "æ—¥æœ¬æ‹‰æ”æ±ªç²¾è¡›ï¼Œå¯¦è¡Œã€Œä»¥è¯åˆ¶è¯ã€çš„ç­–ç•¥ã€‚" },
                    
                    { id: "truck", x: 2400, y: 75, img: "truck.webp", emoji: "ğŸšš", name: "å¡è»Š", type: "exit", req: ["paper", "tire", "gas"], msg: "å¡è»Šå£äº†ï¼(éœ€è¦è¼ªèƒã€æ±½æ²¹ã€æ’¤é€€æ‰‹ä»¤)", quiz:{q:"å¡è»Šå¯ä»¥å•Ÿå‹•äº†ï¼Œæˆ‘å€‘ç›®çš„åœ°æ˜¯å“ªè£¡ï¼Ÿ", opts:["ä¸Šæµ·", "é‡æ…¶"], ans:1}, success: "æ’¤å¾€é‡æ…¶ã€‚" }
                ]
            },
            {
                id: 3, year: "1940", title: "é‡æ…¶ãƒ»æŒä¹…æˆ°",
                history: "1940å¹´ï¼Œæˆ°æ™‚é™ªéƒ½é‡æ…¶ã€‚æ—¥è»é€²è¡Œé•·æœŸç„¡å·®åˆ¥è½Ÿç‚¸ã€‚ä¸­åœ‹è»æ°‘åœ¨ç‰©è³‡æ¥µåº¦åŒ±ä¹çš„æƒ…æ³ä¸‹å …æŒæŠ—æˆ°ï¼Œä»¥ç©ºé–“æ›å–æ™‚é–“ã€‚",
                objective: "ä¿®ç†é€šé¢¨ç³»çµ±ï¼Œç ´è­¯å¯†ç¢¼ã€‚",
                floor: "floor-cave", wall: "wall-cave",
                decor: [{x: 200, y: 50, e:"ğŸ“¦"}, {x: 600, y: 40, e:"ğŸ•¯ï¸"}],
                items: [
                    { id: "fabi", x: 800, y: 75, img: "money_fabi.webp", emoji: "ğŸ’µ", name: "æ³•å¹£", type: "read", desc: "ä¸€æ†æ³•å¹£åªèƒ½è²·ä¸€è¢‹ç±³ã€‚", dse: "æˆ°æ™‚ç‰©è³‡çŸ­ç¼ºï¼Œé€šè²¨è†¨è„¹åš´é‡ã€‚" },
                    { id: "box", x: 2000, y: 70, img: "supplies_box.webp", emoji: "ğŸ“¦", name: "ç‰©è³‡ç®±", type: "box", content: "wrench", desc: "æ‰“é–‹äº†ç®±å­ã€‚" },
                    { id: "wrench", x: 2050, y: 80, img: "wrench.webp", emoji: "ğŸ”§", name: "æ¿æ‰‹", hidden: true, type: "take", desc: "ä¸€æŠŠæ¿æ‰‹ã€‚", isTool: true },
                    { id: "fan", x: 1500, y: 50, img: "fan_ventilator.webp", emoji: "â˜¢ï¸", name: "é€šé¢¨æ‰‡", type: "fan_repair", req: "wrench", msg: "é¢¨æ‰‡å¡ä½äº†ã€‚", unlock: "codebook", desc: "é¢¨æ‰‡è½‰å‹•äº†ã€‚" },
                    { id: "codebook", x: 1550, y: 70, img: "book_code.webp", emoji: "ğŸ“˜", name: "å¯†ç¢¼æœ¬", hidden: true, type: "take", desc: "æ‰å‡ºçš„å¯†ç¢¼æœ¬ã€‚", isKey: true },
                    
                    { id: "manual_tunnel", x: 600, y: 65, img: "book_manual.webp", emoji: "ğŸ““", name: "æ‰‹å†Š", type: "read", desc: "ã€Šåœ°é“æˆ°æ‰‹å†Šã€‹ã€‚", dse: "åœ°é“ä¸‹æœ‰è¤‡é›œçš„ç¶²çµ¡ï¼Œçµåˆé˜²ç«ã€é˜²æ°´ã€é˜²æ¯’åŠŸèƒ½ï¼Œä¸¦è¨­æœ‰å°„æ“Šå­”ï¼Œç¿»æ¿é™·é˜±å·è¥²æ•µäººã€‚" },
                    { id: "map_burma", x: 1000, y: 50, img: "map_burma.webp", emoji: "ğŸ—ºï¸", name: "åœ°åœ–", type: "read", desc: "æ»‡ç·¬å…¬è·¯åœ°åœ–ã€‚", dse: "äººæ‰‹é–‹é‘¿å¾é›²å—è‡³ç·¬ç”¸çš„å…¬è·¯ï¼Œæ˜¯é‹é€ç‰©è³‡çš„é‡è¦é€šé“ã€‚" },
                    { id: "headband", x: 1200, y: 75, img: "headband.webp", emoji: "ğŸ§£", name: "é ­å·¾", type: "read", desc: "æ¸¸æ“ŠéšŠçš„é ­å·¾ã€‚", dse: "æ•µé€²æˆ‘é€€ï¼Œæ•µé€€æˆ‘é€²ï¼Œä¸­å…±æ“…é•·æ–¼æ•µå¾Œæ–¹é€²è¡Œæ¸¸æ“Šæˆ°ä½œæ“¾äº‚ã€‚" },
                    { id: "badge", x: 1800, y: 65, img: "badge_tiger.webp", emoji: "ğŸ–ï¸", name: "å¾½ç« ", type: "read", desc: "é£›è™éšŠå¾½ç« ã€‚", dse: "ç›Ÿè»çš„ç©ºè»æ´åŠ©ã€‚" },
                    
                    { id: "map", x: 2400, y: 60, img: "map_strategy.webp", emoji: "ğŸ“ ", name: "é›»å ±æ©Ÿ", type: "exit", req: "codebook", msg: "ç„¡æ³•ç ´è­¯ã€‚(è«‹æ‰¾å¯†ç¢¼æœ¬)", quiz:{q:"æˆ°ç•¥æ–¹é‡æ˜¯ï¼Ÿ", opts:["é€Ÿæˆ°é€Ÿæ±º", "æŒä¹…æˆ°"], ans:1}, success: "æ­£ç¢ºï¼" }
                ]
            },
            {
                id: 4, year: "1945", title: "æŠ—æˆ°å‹åˆ©",
                history: "1945å¹´8æœˆ15æ—¥ï¼Œæ—¥æœ¬å®£ä½ˆç„¡æ¢ä»¶æŠ•é™ã€‚",
                objective: "æº–å‚™å—é™å„€å¼æ‰€éœ€ç‰©å“ã€‚",
                floor: "floor-red", wall: "wall-office",
                decor: [{x: 300, y: 40, e:"ğŸ®"}, {x: 700, y: 40, e:"ğŸŠ"}],
                items: [
                    { id: "radio_vic", x: 1300, y: 70, img: "radio.webp", emoji: "ğŸ“»", name: "æ”¶éŸ³æ©Ÿ", type: "read", desc: "å»£æ’­ï¼šã€å…«æœˆåäº”æ—¥ï¼Œæ—¥æœ¬å®£å¸ƒç„¡æ¢ä»¶æŠ•é™ã€‚ã€", dse: null },
                    
                    { id: "atom_news", x: 1100, y: 50, img: "newspaper_atom.webp", emoji: "ğŸ—ï¸", name: "å ±ç´™", type: "read", desc: "ç¾è»æŠ•ä¸‹åŸå­å½ˆã€‚", dse: "å…©æšåŸå­å½ˆã€Œèƒ–å­ã€å’Œã€Œå°ç”·å­©ã€åŠ é€Ÿæ—¥æœ¬æŠ•é™ã€‚" },
                    { id: "leaflet_soviet", x: 900, y: 75, img: "leaflet_soviet.webp", emoji: "ğŸ“„", name: "å‚³å–®", type: "read", desc: "è˜‡è¯ç´…è»å‡ºå…µæ±åŒ—ã€‚", dse: "è˜‡è¯åƒæˆ°ï¼Œä¸¦åŠ©å…±ç”¢é»¨å–å¾—å¤§é‡æ—¥è»ç²¾è‰¯è£å‚™ã€‚" },
                    { id: "photo_pearl", x: 700, y: 60, img: "photo_pearl.webp", emoji: "ğŸ–¼ï¸", name: "ç…§ç‰‡", type: "read", desc: "æ—¥è»å·è¥²çç æ¸¯ã€‚", dse: "æ—¥æœ¬æ–¼1941å¹´12æœˆ7æ—¥å·è¥²ç¾åœ‹æ–¼å¤å¨å¤·çš„æµ·è»åŸºåœ°ï¼Œä¿ƒæˆç¾åœ‹åƒæˆ°ã€‚" },

                    { id: "safe_pen", x: 1700, y: 70, img: "safe.webp", emoji: "ğŸ”", name: "ä¿éšªç›’", type: "lock", code: "0815", hint: "å¯†ç¢¼æ˜¯å‹åˆ©æ—¥æœŸ (MMDD)ã€‚(è½è½å»£æ’­ï¼Ÿ)", unlock: "pen", desc: "ç›’å­æ‰“é–‹äº†ã€‚" },
                    { id: "pen", x: 1750, y: 80, img: "pen.webp", emoji: "âœ’ï¸", name: "ç°½å­—ç­†", hidden: true, type: "take", desc: "æ´¾å…‹é‡‘ç­†ã€‚", isKey: true },
                    { id: "coat", x: 500, y: 60, img: "coat_military.webp", emoji: "ğŸ§¥", name: "å¤–å¥—", type: "multi_search", steps: ["ä¸€ä»¶è»äººå¤–å¥—ã€‚", "é€™å¤–å¥—æœ‰é»å¸¥æ°£...", "å£è¢‹å¥½åƒæœ‰æ±è¥¿ï¼šæ˜¯é‘°åŒ™ï¼"], unlock: "key", desc: "ç©ºäº†ã€‚" },
                    { id: "key", x: 550, y: 70, img: "key_brass.webp", emoji: "ğŸ—ï¸", name: "é‘°åŒ™", hidden: true, type: "take", desc: "éŠ…é‘°åŒ™ã€‚", isTool: true },
                    { id: "cabinet", x: 800, y: 60, img: "cabinet_wood.webp", emoji: "ğŸ—„ï¸", name: "æ«ƒå­", type: "key_lock", req: "key", msg: "é–ä½äº†ã€‚", unlock: "seal", desc: "æ«ƒå­æ‰“é–‹äº†ã€‚" },
                    { id: "seal", x: 850, y: 70, img: "seal_national.webp", emoji: "ğŸ®", name: "åœ‹ç’½", hidden: true, type: "take", desc: "åœ‹ç’½ã€‚", isKey: true },
                    { id: "table", x: 2300, y: 70, img: "surrender_table.webp", emoji: "ğŸ•Šï¸", name: "å—é™è‡º", type: "exit", req: ["seal", "pen"], msg: "å„€å¼æœªæº–å‚™å¥½ï¼", quiz:{q:"æŠ—æ—¥æˆ°çˆ­çš„å‹åˆ©åŸå› æ˜¯ï¼Ÿ", opts:["åŸå­å½ˆ", "å…¨æ°‘æ—æŠ—æˆ°"], ans:1}, success: "ä¸­è¯æ°‘æ—è¬æ­²ï¼" }
                ]
            }
        ];

        // --- 3. æ ¸å¿ƒé‚è¼¯ ---
        function initLevel() {
            const level = LEVELS[gameState.level];
            gameState.interactions = {};
            
            document.getElementById('hud-year').innerText = level.year;
            document.getElementById('hud-title').innerText = level.title;
            document.getElementById('intro-year').innerText = level.year;
            document.getElementById('intro-title').innerText = level.title;
            document.getElementById('intro-hist').innerText = level.history;
            document.getElementById('intro-obj').innerText = level.objective;
            
            document.getElementById('intro-screen').classList.add('show');
            document.getElementById('ui-layer').style.display = 'none';
            document.getElementById('viewport').style.opacity = 0; 
            isPaused = true;

            document.getElementById('world').style.width = WORLD_WIDTH + 'px';
            document.getElementById('layer-floor').className = `layer-floor ${level.floor}`;
            document.getElementById('layer-wall').className = `layer-wall ${level.wall}`;
            
            const decorLayer = document.getElementById('layer-decor');
            decorLayer.innerHTML = '';
            level.decor.forEach(d => {
                const el = document.createElement('div');
                el.className = 'sprite'; el.style.left = d.x+'px'; el.style.top = d.y+'%';
                el.innerHTML = `<div class="decor-model">${d.img ? `<img src="${d.img}" class="w-full h-full object-contain">` : d.e}</div>`;
                decorLayer.appendChild(el);
            });

            renderItems();

            player.x = 100; player.y = 80;
            updatePlayerPos();
            updateInventoryUI();
        }

        // --- é‡å¯«çš„ renderItems å‡½æ•¸ï¼šä¿®å¾©æ¸²æŸ“èˆ‡äº’å‹• ---
        function renderItems() {
            const mainLayer = document.getElementById('layer-main');
            const oldItems = mainLayer.querySelectorAll('.item-sprite');
            oldItems.forEach(e => e.remove());

            LEVELS[gameState.level].items.forEach(item => {
                // å¦‚æœæ˜¯éš±è—ç‰©å“ï¼Œä¸”å°šæœªè§£é–ï¼Œå‰‡ä¸æ¸²æŸ“
                if (item.hidden && !gameState.unlocked.includes(item.id)) return;
                // å¦‚æœç‰©å“å·²æ”¾å…¥èƒŒåŒ…ï¼Œå‰‡å¾å ´æ™¯ä¸­ç§»é™¤
                if (gameState.inventory.includes(item.id)) return;

                const el = document.createElement('div');
                el.className = 'sprite item-sprite';
                el.style.left = item.x + 'px';
                el.style.top = item.y + '%';
                el.dataset.id = item.id;
                
                // æ§‹å»ºå…§éƒ¨ HTMLï¼šåŒæ™‚åŒ…å« Image å’Œ Emoji
                // é‡è¦ï¼šç¢ºä¿å…©å€‹å…ƒç´ éƒ½æœ‰ item-model é¡åˆ¥ï¼Œé€™æ¨£ CSS æ‰èƒ½æ­£ç¢ºå¥—ç”¨å¤§å°å’Œäº’å‹•
                // ä½¿ç”¨ onerror è‡ªå‹•åˆ‡æ›é¡¯ç¤º
                let innerHTML = '';
                
                if (item.img) {
                    // å„ªå…ˆé¡¯ç¤ºåœ–ç‰‡ï¼Œå¤±æ•—æ™‚éš±è—è‡ªå·±ä¸¦é¡¯ç¤ºä¸‹ä¸€å€‹å…„å¼Ÿå…ƒç´  (Emoji)
                    innerHTML += `<img src="${item.img}" class="item-model" alt="${item.name}" 
                        onload="this.style.display='flex'; this.nextElementSibling.style.display='none';" 
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                        style="display:none;">`; // é è¨­éš±è—ï¼Œç­‰å¾… onload è§¸ç™¼ï¼Œé¿å…é–ƒçˆ
                    // å¾Œå‚™ Emojiï¼šé è¨­é¡¯ç¤º (é˜²æ­¢åœ–ç‰‡åŠ è¼‰æ…¢æ™‚ç©ºç™½)ï¼Œå¦‚æœåœ–ç‰‡è¼‰å…¥æˆåŠŸæœƒè¢«éš±è—
                    innerHTML += `<div class="item-model emoji-mode" style="display:flex;">${item.emoji}</div>`;
                } else {
                    // åªæœ‰ Emoji çš„æƒ…æ³
                    innerHTML += `<div class="item-model emoji-mode">${item.emoji}</div>`;
                }

                // æª¢æŸ¥æ˜¯å¦æ»¿è¶³å‡ºå£æ¢ä»¶ä»¥æ·»åŠ ç™¼å…‰æ•ˆæœ
                let reqMet = false;
                if (item.type === 'exit') {
                    if (Array.isArray(item.req)) {
                        reqMet = item.req.every(r => gameState.inventory.includes(r));
                    } else {
                        reqMet = gameState.inventory.includes(item.req);
                    }
                }
                if (reqMet) el.classList.add('exit-glow');

                el.innerHTML = innerHTML + `<div class="name-tag">${item.name}</div>`;
                mainLayer.appendChild(el);
            });
        }

// ä¿®æ­£ï¼šä½¿ç”¨ requestAnimationFrame çš„æ™‚é–“æˆ³ä¾†è¨ˆç®— deltaTime
	        let lastTime = 0;
	        function gameLoop(timestamp) {
	            if (!lastTime) lastTime = timestamp;
	            const deltaTime = timestamp - lastTime;
	            lastTime = timestamp;
	
	            if (!isPaused) {
	                let dx = 0; let dy = 0;
	                // ä¿®æ­£ï¼šä½¿ç”¨ deltaTime ç¢ºä¿ç§»å‹•é€Ÿåº¦åœ¨ä¸åŒå¹€ç‡ä¸‹ä¿æŒä¸€è‡´
	                // 16.67ms ç´„ç­‰æ–¼ 60 FPS
	                const moveSpeed = SPEED * (deltaTime / 16.67); 
	
	                if (keys.l) dx = -moveSpeed; if (keys.r) dx = moveSpeed;
	                if (keys.u) dy = -moveSpeed/2; if (keys.d) dy = moveSpeed/2;
	
	                if (dx !== 0 || dy !== 0) {
	                    player.x = Math.max(30, Math.min(WORLD_WIDTH-30, player.x + dx));
	                    player.y = Math.max(FLOOR_Y_MIN, Math.min(FLOOR_Y_MAX, player.y + (dy*0.1)));
	                    updatePlayerPos();
	                    updateCamera();
	                    checkProximity();
	                }
	            }
	            requestAnimationFrame(gameLoop);
	        }

        function updatePlayerPos() {
            if(player.el) {
                player.el.style.left = player.x + 'px';
                player.el.style.top = player.y + '%';
                if (keys.l) player.el.style.transform = "translate(-50%, -100%) scaleX(-1)";
                if (keys.r) player.el.style.transform = "translate(-50%, -100%) scaleX(1)";
                player.el.style.zIndex = Math.floor(player.y * 10);
            }
        }

        function updateCamera() {
            let camX = Math.max(0, Math.min(WORLD_WIDTH - window.innerWidth, player.x - window.innerWidth/3));
            document.getElementById('world').style.transform = `translateX(${-camX}px)`;
        }

        function checkProximity() {
            let closest = null, minDist = INTERACT_DIST_X;
            // é€™è£¡çš„é‚è¼¯ä¾è³´ item.x/yï¼Œèˆ‡ DOM çµæ§‹ç„¡é—œï¼Œåªè¦ DOM å­˜åœ¨å³å¯
            document.querySelectorAll('.item-sprite').forEach(el => {
                const item = LEVELS[gameState.level].items.find(i => i.id === el.dataset.id);
                if (!item) return;
                const dx = Math.abs(player.x - item.x);
                const dy = Math.abs(player.y - item.y); // åŠ å…¥ Y è»¸æª¢æ¸¬ï¼Œé¿å…èª¤è§¸
                
                if (dx < INTERACT_DIST_X && dy < INTERACT_DIST_Y) {
                    if (dx < minDist) { minDist = dx; closest = {data:item, el:el}; }
                }
                el.classList.remove('active');
            });

            activeItem = closest ? closest.data : null;
            if (closest) { 
                closest.el.classList.add('active'); 
                document.getElementById('action-btn').classList.add('active'); 
            }
            else {
                document.getElementById('action-btn').classList.remove('active');
            }
        }

        function triggerInteract() { if (activeItem && !isPaused) handleItem(activeItem); }

        function handleItem(item) {
            if (!gameState.interactions[item.id]) gameState.interactions[item.id] = 0;
            gameState.interactions[item.id]++;
            const count = gameState.interactions[item.id];

            if (item.type === "multi_search") {
                if (gameState.unlocked.includes(item.unlock)) { showDialog(item.name, item.desc, null, item); return; }
                const idx = Math.min(count - 1, item.steps.length - 1);
                showDialog(item.name, item.steps[idx], null, item);
                if (count >= item.steps.length) setTimeout(() => unlockItem(item.unlock), 1000);
            }
            else if (item.type === "lock") {
                if (gameState.unlocked.includes(item.id)) showDialog(item.name, item.desc, null, item);
                else if ((item.id === "safe" && !gameState.interactions["calendar"]) ||
                         (item.id === "safe_pen" && !gameState.interactions["radio_vic"])) {
                     showDialog(item.name, item.hint || "æˆ‘ä¸çŸ¥é“å¯†ç¢¼...", null, item);
                }
                else {
                    showLock(item);
                }
            } 
            else if (item.type === "key_lock") {
                if (gameState.unlocked.includes(item.id)) showDialog(item.name, item.desc, item.dse, item);
                else {
                    if (gameState.inventory.includes(item.req)) { 
                        unlockItem(item.id); 
                        // å¼·åˆ¶è§£é–å…§å®¹ç‰©
                        const content = LEVELS[gameState.level].items.find(i => i.id === item.unlock);
                        if(content) unlockItem(content.id);
                        
                        showDialog("æˆåŠŸ", "ä½¿ç”¨äº†é‘°åŒ™ï¼Œç™¼ç¾äº†é‡è¦ç‰©å“ï¼", null, item); 
                    }
                    else showDialog("ä¸Šé–", item.msg, null, item);
                }
            }
            else if (item.type === "fan_repair") {
                if (gameState.unlocked.includes(item.id)) showDialog(item.name, item.desc, null, item);
                else if (gameState.inventory.includes(item.req)) {
                    showDialog("ä¿®ç†", "ä¿®å¥½äº†ï¼æ˜¯å¦å•Ÿå‹•ï¼Ÿ", null, item, [{txt:"å•Ÿå‹•", fn:()=>{
                        closeModal(); unlockItem(item.id);
                        setTimeout(()=>unlockItem(item.unlock), 500);
                    }}]);
                } else showDialog("æ•…éšœ", item.msg, null, item);
            }
            else if (item.type === "box") {
                 showDialog(item.name, item.desc, null, item, [{txt:"æ‰“é–‹", fn:()=>{
                    closeModal(); unlockItem(item.content);
                }}]);
            }
            else if (item.type === "exit") {
                let reqMet = Array.isArray(item.req) ? item.req.every(r => gameState.inventory.includes(r)) : gameState.inventory.includes(item.req);
                if (reqMet) showQuiz(item);
                else showDialog("ç„¡æ³•å‰é€²", item.msg, null, item);
            }
            else {
                showDialog(item.name, item.desc, item.dse, item);
                if (item.type === "take") pickupItem(item);
                if (item.dse) saveNote(item.name, item.dse);
            }
        }

        function unlockItem(id) {
            if (!gameState.unlocked.includes(id)) {
                gameState.unlocked.push(id);
                renderItems();
                // å‹•ç•«
                const el = document.querySelector(`.sprite[data-id="${id}"] .item-model`);
                if(el) el.classList.add('drop-anim');
            }
        }

        function pickupItem(item) {
            if (!gameState.inventory.includes(item.id)) {
                gameState.inventory.push(item.id);
                updateInventoryUI();
                showToast(`ç²å¾—ï¼š${item.name}`);
                renderItems();
                if (item.dse) saveNote(item.name, item.dse);
            }
        }

        function updateInventoryUI() {
            const div = document.getElementById('hud-inventory');
            if (!div) return;
            if (gameState.inventory.length === 0) { div.innerHTML = '<span class="text-xs text-stone-600 italic">ç©º</span>'; return; }
            div.innerHTML = '';
            gameState.inventory.forEach(id => {
                let name = id;
                let emoji = '';
                // ä¿®æ­£ï¼šå¾æ•´å€‹ LEVELS æ•¸çµ„ä¸­æŸ¥æ‰¾ç‰©å“ä¿¡æ¯
                for (let l of LEVELS) {
                    let f = l.items.find(i => i.id === id);
                    if (f) { name = f.name; emoji = f.emoji; break; }
                }
                div.innerHTML += `<div class="bg-stone-800 text-lg w-8 h-8 flex items-center justify-center rounded border border-stone-600 shadow text-white" title="${name}">${emoji}</div>`;
            });
        }

        function showDialog(title, desc, dse, itemData, opts) {
            isPaused = true;
            document.getElementById('modal').classList.add('show');
            document.getElementById('m-title').innerText = title;
            document.getElementById('m-desc').innerText = desc;
            
            // å½ˆçª—åœ–ç¤ºé‚è¼¯ï¼šå„ªå…ˆä½¿ç”¨åœ–ç‰‡
            let iconImg = `<div class="text-4xl">${itemData.emoji}</div>`;
            if(itemData.img) {
                // ä½¿ç”¨ onerror å›é€€ï¼Œç¢ºä¿å½ˆçª—ä¹Ÿæœ‰åœ–
                iconImg = `<img src="${itemData.img}" class="w-full h-full object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                           <div class="text-4xl hidden">${itemData.emoji}</div>`;
            }
            document.getElementById('m-icon-box').innerHTML = iconImg;
            
            const dseEl = document.getElementById('m-dse');
            if (dse) { dseEl.classList.remove('hidden'); document.getElementById('m-dse-text').innerText = dse; } 
            else dseEl.classList.add('hidden');
            
            const optDiv = document.getElementById('m-opts');
            optDiv.innerHTML = '';
            if (opts) {
                opts.forEach(o => {
                    const btn = document.createElement('button');
                    btn.className = "w-full bg-amber-600 text-white py-3 rounded font-bold shadow";
                    btn.innerText = o.txt;
                    btn.onclick = o.fn;
                    optDiv.appendChild(btn);
                });
            }
        }

        function showLock(item) {
            showDialog(item.name, item.hint, null, item, [{txt:"è§£é–", fn:()=>{
                const div = document.getElementById('m-opts');
                div.innerHTML = `
                    <input id="code-in" class="w-full text-3xl text-center p-2 mb-4 border rounded text-black tracking-widest" readonly placeholder="____">
                    <div class="grid grid-cols-3 gap-2">
                        ${[1,2,3,4,5,6,7,8,9].map(n=>`<button onclick="typeCode(${n})" class="num-btn">${n}</button>`).join('')}
                        <button onclick="typeCode('C')" class="num-btn bg-red-200 text-red-800">C</button>
                        <button onclick="typeCode(0)" class="num-btn">0</button>
                        <button onclick="submitCode('${item.id}','${item.code}','${item.unlock}')" class="num-btn bg-green-600 text-white">OK</button>
                    </div>
                `;
            }}]);
        }

        window.typeCode = function(n) {
            const el = document.getElementById('code-in');
            if(n==='C') el.value = '';
            else if(el.value.length < 4) el.value += n;
        };

        window.submitCode = function(id, code, unlockId) {
            const val = document.getElementById('code-in').value;
            if (val === code) {
                const item = LEVELS[gameState.level].items.find(i => i.id === id);
                unlockItem(item.id);
                closeModal();
                setTimeout(() => {
                    unlockItem(unlockId); 
                    showDialog("è§£é–æˆåŠŸ", `ä¿éšªç®±æ‰“é–‹äº†ï¼ç™¼ç¾äº†é‡è¦æ–‡ä»¶ï¼`, null, item);
                }, 300);
            } else {
                alert("å¯†ç¢¼éŒ¯èª¤");
                document.getElementById('code-in').value = '';
            }
        };

        function showQuiz(item) {
            showDialog("æŠ‰æ“‡", item.quiz.q, null, item, [
                {txt: item.quiz.opts[0], fn:()=>checkAns(0, item.quiz.ans)},
                {txt: item.quiz.opts[1], fn:()=>checkAns(1, item.quiz.ans)}
            ]);
        }

        function checkAns(i, ans) {
            if (i === ans) { closeModal(); alert("æ­£ç¢ºï¼"); nextLevel(); }
            else alert("éŒ¯èª¤ï¼Œè«‹å›æƒ³ç·šç´¢ã€‚");
        }

        function closeModal() { document.getElementById('modal').classList.remove('show'); isPaused = false; }

        function nextLevel() {
            if (gameState.level < LEVELS.length - 1) {
                gameState.level++;
                gameState.inventory = [];
                gameState.unlocked = [];
                initLevel();
            } else {
                document.getElementById('ending-screen').style.display = 'flex';
                isPaused = true;
            }
        }

        function startGame() { 
            document.getElementById('intro-screen').classList.remove('show'); 
            document.getElementById('ui-layer').style.display = 'block'; 
            document.getElementById('viewport').style.opacity = 1;
            isPaused = false; gameLoop(); 
        }
        function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = 1; setTimeout(()=>t.style.opacity=0, 2000); }
        function saveNote(t, c) { if(!gameState.notes.some(n=>n.t===t)) { gameState.notes.push({t,c}); document.getElementById('nb-content').innerHTML+=`<div class="border-b pb-2 border-stone-300"><b class="text-amber-800">ã€${t}ã€‘</b><br>${c}</div>`; document.getElementById('note-dot').classList.remove('hidden'); }}
        function toggleNotebook() { const nb = document.getElementById('notebook'); nb.classList.toggle('open'); document.getElementById('note-dot').classList.add('hidden'); isPaused = nb.classList.contains('open'); }

        // Input
        const setKey = (k, v) => { if(k==='ArrowUp'||k==='w') keys.u=v; if(k==='ArrowDown'||k==='s') keys.d=v; if(k==='ArrowLeft'||k==='a') keys.l=v; if(k==='ArrowRight'||k==='d') keys.r=v; };
        window.addEventListener('keydown', e => { setKey(e.key, true); if(e.key===' '||e.key==='Enter') triggerInteract(); });
        window.addEventListener('keyup', e => setKey(e.key, false));
        
        const bindTouch = (cls, k) => { const el=document.querySelector(cls); el.addEventListener('pointerdown', e=>{e.preventDefault(); keys[k]=true;}); el.addEventListener('pointerup', e=>{e.preventDefault(); keys[k]=false;}); el.addEventListener('pointerleave', e=>{e.preventDefault(); keys[k]=false;}); };
        bindTouch('.btn-u','u'); bindTouch('.btn-d','d'); bindTouch('.btn-l','l'); bindTouch('.btn-r','r');

        window.onload = () => { 
            lucide.createIcons(); 
            player.el = document.getElementById('player');
            initLevel(); 
        };
    </script>
</body>

</html>
